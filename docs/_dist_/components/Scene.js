/* src/components/Scene.svelte generated by Svelte v3.31.2 */
import {
	SvelteComponent,
	binding_callbacks,
	create_slot,
	detach,
	element,
	init,
	insert,
	safe_not_equal,
	space,
	transition_in,
	transition_out,
	update_slot
} from "../../web_modules/svelte/internal.js";

import { onMount, setContext } from "../../web_modules/svelte.js";
import { writable } from "../../web_modules/svelte/store.js";
import { Scene, Color, PerspectiveCamera, WebGLRenderer } from "../../web_modules/three.js";

function create_fragment(ctx) {
	let div;
	let t;
	let current;
	const default_slot_template = /*#slots*/ ctx[5].default;
	const default_slot = create_slot(default_slot_template, ctx, /*$$scope*/ ctx[4], null);

	return {
		c() {
			div = element("div");
			t = space();
			if (default_slot) default_slot.c();
		},
		m(target, anchor) {
			insert(target, div, anchor);
			/*div_binding*/ ctx[6](div);
			insert(target, t, anchor);

			if (default_slot) {
				default_slot.m(target, anchor);
			}

			current = true;
		},
		p(ctx, [dirty]) {
			if (default_slot) {
				if (default_slot.p && dirty & /*$$scope*/ 16) {
					update_slot(default_slot, default_slot_template, ctx, /*$$scope*/ ctx[4], dirty, null, null);
				}
			}
		},
		i(local) {
			if (current) return;
			transition_in(default_slot, local);
			current = true;
		},
		o(local) {
			transition_out(default_slot, local);
			current = false;
		},
		d(detaching) {
			if (detaching) detach(div);
			/*div_binding*/ ctx[6](null);
			if (detaching) detach(t);
			if (default_slot) default_slot.d(detaching);
		}
	};
}

function instance($$self, $$props, $$invalidate) {
	let { $$slots: slots = {}, $$scope } = $$props;
	let { width = 600 } = $$props;
	let { height = 400 } = $$props;
	let { background = "#fff" } = $$props;
	let target;
	const scene = new Scene();
	scene.background = new Color(background);
	const camera = new PerspectiveCamera(75, width / height, 0.1, 1000);

	const renderer = new WebGLRenderer({}); // alpha: true,
	// antialias: true

	camera.position.z = 5;
	renderer.setSize(width, height);

	const ctx = {
		scene,
		camera,
		renderer,
		renderFns: [],
		time: writable(Date.now())
	};

	setContext("sceneCtx", ctx);

	onMount(() => {
		let rafId;

		const animate = () => {
			ctx.time.set(Date.now());
			rafId = requestAnimationFrame(animate);
			renderer.render(scene, camera);
		};

		animate();
		return () => cancelAnimationFrame(rafId);
	});

	function div_binding($$value) {
		binding_callbacks[$$value ? "unshift" : "push"](() => {
			target = $$value;
			$$invalidate(0, target);
		});
	}

	$$self.$$set = $$props => {
		if ("width" in $$props) $$invalidate(1, width = $$props.width);
		if ("height" in $$props) $$invalidate(2, height = $$props.height);
		if ("background" in $$props) $$invalidate(3, background = $$props.background);
		if ("$$scope" in $$props) $$invalidate(4, $$scope = $$props.$$scope);
	};

	$$self.$$.update = () => {
		if ($$self.$$.dirty & /*target*/ 1) {
			$: target && target.appendChild(renderer.domElement);
		}
	};

	return [target, width, height, background, $$scope, slots, div_binding];
}

class Scene_1 extends SvelteComponent {
	constructor(options) {
		super();
		init(this, options, instance, create_fragment, safe_not_equal, { width: 1, height: 2, background: 3 });
	}
}

export default Scene_1;